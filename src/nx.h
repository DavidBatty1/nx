//----------------------------------------------------------------------------------------------------------------------
// NX system
// Launches other subsystems based command line arguments, and manages memory.
//----------------------------------------------------------------------------------------------------------------------

#pragma once

#include "host.h"
#include "machine.h"

class Nx
{
public:
    Nx(IHost& host, u32* img);

    // Advance as many number of t-states as possible.  Returns the number of t-States that were processed.
    i64 update();

private:
    IHost&              m_host;
    i64                 m_tState;
    std::vector<bool>   m_keys;
    Machine             m_machine;
};

//----------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------

#ifdef NX_IMPL

Nx::Nx(IHost& host, u32* img)
    : m_host(host)
    , m_tState(0)
    , m_keys((int)Key::COUNT)
    , m_machine(host, img, m_keys)
{

}

i64 Nx::update()
{
    return m_machine.update(m_tState);
}

//----------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------

#endif // NX_IMPL
